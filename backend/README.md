# Quasar Backend

Quasar is an open-source live chat project.

## База данных и миграции

Проект использует PostgreSQL и Sequelize ORM. Для работы с базой данных и миграциями используется sequelize-cli.

### Настройка подключения к базе данных

Настройки подключения к базе данных находятся в файле `.env.dev` и `.env.example`. 
Для продакшн окружения создайте файл `.env` с нужными параметрами.

### Команды для работы с миграциями

```bash
# Создание базы данных
npm run db:create

# Применение всех миграций
npm run db:migrate

# Отмена последней миграции
npm run db:migrate:undo

# Отмена всех миграций
npm run db:migrate:undo:all

# Заполнение базы тестовыми данными
npm run db:seed:all

# Удаление тестовых данных
npm run db:seed:undo:all

# Создание новой миграции
npm run make:migration <название-миграции>

# Создание нового сида
npm run make:seed <название-сида>
```

### Структура базы данных

База данных имеет следующие таблицы:

- **Users** - пользователи системы
- **ChatRooms** - чат-комнаты
- **RoomMembers** - участники чат-комнат
- **Messages** - сообщения в чат-комнатах

## Запуск приложения

Для запуска сервера в режиме разработки:

```bash
# Установка зависимостей
npm install

# Запуск сервера
npm run dev
```

Сервер запустится на порту, указанном в .env файле (по умолчанию 8000).

## API Endpoints

### Аутентификация

- `POST /api/users/register` - регистрация нового пользователя
- `POST /api/users/login` - вход в систему
- `GET /api/users/me` - информация о текущем пользователе

### Чат-комнаты

- `POST /api/rooms` - создание новой комнаты
- `GET /api/rooms/owned` - получение списка созданных пользователем комнат
- `GET /api/rooms/:id` - получение информации о комнате

### Участники комнат

- `POST /api/memberships/join` - присоединение к комнате по коду доступа
- `DELETE /api/memberships/:roomId` - выход из комнаты
- `GET /api/memberships/joined` - получение списка комнат, в которых состоит пользователь
- `GET /api/memberships/room/:roomId` - получение списка участников комнаты

### Сообщения

- `POST /api/messages` - отправка сообщения
- `GET /api/messages/room/:roomId` - получение списка сообщений в комнате 