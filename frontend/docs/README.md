# Документация фронтенда Quasar Chat

## Введение

Данная документация описывает архитектуру и основные компоненты фронтенд-части проекта Quasar Chat. Quasar Chat - это платформа для создания корпоративных чатов, которая предоставляет удобное и бесплатное on-premise решение для организаций и образовательных учреждений.

## Технический стек

- **React** - библиотека для создания пользовательских интерфейсов
- **Next.js** - фреймворк для React с SSR и файловой маршрутизацией
- **TypeScript** - типизированный JavaScript
- **Ant Design** - библиотека UI-компонентов
- **Tailwind CSS** - utility-first CSS фреймворк
- **Axios** - HTTP-клиент
- **React Hook Form** - библиотека для работы с формами
- **Zod** - библиотека для валидации данных
- **Socket.io** - библиотека для работы с WebSockets

## Структура проекта

```
frontend/
├── public/              # Статические файлы
├── src/                 # Исходный код
│   ├── api/             # API клиенты
│   ├── app/             # Страницы Next.js (File-based routing)
│   ├── components/      # React компоненты
│   │   ├── auth/        # Компоненты авторизации
│   │   ├── chat/        # Компоненты чата
│   │   ├── home/        # Компоненты домашней страницы
│   │   └── nav/         # Компоненты навигации
│   ├── context/         # React контексты
│   ├── hooks/           # Кастомные React хуки
│   └── lib/             # Вспомогательные библиотеки
├── docs/                # Документация
└── ...
```

## Аутентификация

### Архитектура аутентификации

Аутентификация в приложении построена на основе контекста `AuthContext`, который предоставляет информацию о текущем пользователе и методы для авторизации, регистрации и выхода из системы.

### Ключевые файлы

- `src/context/AuthContext.tsx` - контекст аутентификации
- `src/hooks/useAuth.ts` - хук для доступа к контексту аутентификации
- `src/api/auth.ts` - API клиент для работы с бэкендом аутентификации
- `src/components/auth/LoginForm.tsx` - форма входа в систему
- `src/components/auth/RegisterForm.tsx` - форма регистрации
- `src/components/auth/UserNav.tsx` - навигация пользователя (отображает профиль и кнопку выхода)

### Процесс аутентификации

1. Пользователь вводит данные в форму входа или регистрации
2. Форма отправляет данные на бэкенд через соответствующие методы в `api/auth.ts`
3. Бэкенд проверяет данные и возвращает информацию о пользователе
4. `AuthContext` сохраняет информацию о пользователе и обновляет состояние приложения
5. При загрузке приложения `AuthContext` проверяет наличие текущего пользователя через API

## Управление комнатами

### Архитектура управления комнатами

Управление комнатами построено на основе контекста `RoomContext`, который предоставляет информацию о комнатах пользователя и методы для работы с ними.

### Ключевые файлы

- `src/context/RoomContext.tsx` - контекст управления комнатами
- `src/hooks/useRooms.ts` - хук для доступа к контексту комнат
- `src/api/rooms.ts` - API клиент для работы с бэкендом комнат
- `src/components/nav/RoomsNavBar.tsx` - боковая панель со списком комнат
- `src/components/home/HomeNav.tsx` - компонент домашней страницы для отображения комнат
- `src/app/rooms/create/page.tsx` - страница создания комнаты
- `src/app/rooms/join/page.tsx` - страница присоединения к комнате
- `src/app/rooms/[id]/page.tsx` - страница конкретной комнаты

### Процесс управления комнатами

1. При загрузке приложения `RoomContext` загружает список комнат пользователя
2. `RoomsNavBar` отображает список комнат в боковой панели
3. Пользователь может создать новую комнату или присоединиться к существующей
4. При создании или присоединении к комнате, `RoomContext` обновляет список комнат
5. Боковая панель отображается только если пользователь авторизован и состоит хотя бы в одной комнате

## Чат

### Архитектура чата

Чат построен на основе WebSockets (Socket.io) для обмена сообщениями в реальном времени.

### Ключевые файлы

- `src/components/chat/ChatRoom.tsx` - основной компонент чата
- `src/components/chat/MessageList.tsx` - список сообщений
- `src/components/chat/MessageItem.tsx` - отдельное сообщение
- `src/components/chat/MessageInput.tsx` - поле ввода сообщения
- `src/api/messages.ts` - API клиент для работы с сообщениями
- `src/lib/socket.ts` - клиент Socket.io

### Процесс обмена сообщениями

1. При открытии комнаты, компонент `ChatRoom` загружает историю сообщений через API
2. `ChatRoom` подписывается на события Socket.io для получения новых сообщений
3. Пользователь вводит сообщение в `MessageInput`
4. Сообщение отправляется на сервер через API и Socket.io
5. Новое сообщение добавляется в список сообщений в реальном времени

## Навигация

### Архитектура навигации

Навигация в приложении построена на основе маршрутизации Next.js и компонентов Ant Design.

### Ключевые файлы

- `src/app/layout.tsx` - основной layout приложения
- `src/components/nav/RoomsNavBar.tsx` - боковая панель с комнатами
- `src/components/auth/UserNav.tsx` - навигация пользователя

### Процесс навигации

1. `RoomsNavBar` отображается только если пользователь авторизован и состоит хотя бы в одной комнате
2. При клике на комнату, пользователь переходит на страницу комнаты
3. `UserNav` отображает меню пользователя с возможностью выхода из системы

## Как внести свой вклад

### Настройка окружения

1. Клонировать репозиторий
2. Установить зависимости: `npm install`
3. Запустить фронтенд в режиме разработки: `npm run dev`

### Добавление новой функциональности

1. **Новый компонент**:
   - Создать компонент в соответствующей директории (`src/components/`)
   - Использовать TypeScript для типизации пропсов
   - Следовать существующим стилям и шаблонам

2. **Новая страница**:
   - Создать файл в директории `src/app/`
   - Следовать шаблону маршрутизации Next.js
   - Убедиться, что страница использует правильные компоненты layout

3. **Новый API клиент**:
   - Добавить типы и методы в соответствующий файл в `src/api/`
   - Использовать axios для HTTP запросов
   - Правильно обрабатывать ошибки

### Правила оформления кода

1. Использовать TypeScript для всех новых компонентов и функций
2. Следовать принципам отзывчивого дизайна с помощью Tailwind CSS
3. Использовать компоненты Ant Design где это возможно
4. Писать юнит-тесты для новой функциональности

## Основные контексты

### AuthContext

`AuthContext` управляет состоянием аутентификации пользователя и предоставляет методы для входа, регистрации и выхода из системы.

```typescript
interface AuthContextType {
  user: User | null;         // Текущий пользователь
  loading: boolean;          // Загрузка аутентификации
  login: (data: LoginParams) => Promise<void>;     // Метод входа
  register: (data: RegisterParams) => Promise<void>; // Метод регистрации
  logout: () => Promise<void>;   // Метод выхода
  error: string | null;      // Ошибка аутентификации
}
```

### RoomContext

`RoomContext` управляет состоянием комнат пользователя и предоставляет методы для работы с ними.

```typescript
interface RoomContextType {
  userRooms: Room[];         // Список комнат пользователя
  loading: boolean;          // Загрузка комнат
  error: string | null;      // Ошибка загрузки комнат
  refreshRooms: () => Promise<void>;  // Метод обновления списка комнат
  clearRooms: () => void;    // Метод очистки списка комнат
}
```

## Хуки

### useAuth

`useAuth` предоставляет доступ к контексту аутентификации.

```typescript
const { user, loading, login, register, logout, error } = useAuth();
```

### useRooms

`useRooms` предоставляет доступ к контексту комнат.

```typescript
const { userRooms, loading, error, refreshRooms, clearRooms } = useRooms();
```

## Заключение

Данная документация описывает основные компоненты и архитектуру фронтенд-части проекта Quasar Chat. Для более подробной информации обратитесь к коду проекта и комментариям в коде. 