# Компоненты фронтенда Quasar Chat

## Общие компоненты

### Layout (app/layout.tsx)

Основной шаблон приложения, который определяет структуру всех страниц.

**Функциональность:**
- Содержит `AuthProvider` и `RoomProvider` для доступа к контексту аутентификации и комнат
- Включает верхнюю панель навигации с логотипом и пользовательским меню
- Отображает боковую панель с комнатами, если пользователь авторизован и состоит хотя бы в одной комнате
- Оборачивает содержимое всех страниц

**Пример использования:**
```tsx
// Автоматически используется Next.js для всех страниц
export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="ru">
      <body>
        <AuthProvider>
          <RoomProvider>
            <Layout>
              <Layout.Header>...</Layout.Header>
              <Layout hasSider>
                <RoomsNavBar />
                <Layout.Content>{children}</Layout.Content>
              </Layout>
            </Layout>
          </RoomProvider>
        </AuthProvider>
      </body>
    </html>
  );
}
```

## Компоненты аутентификации

### LoginForm

Форма входа в систему.

**Props:** Нет

**Состояние:**
- Данные формы (email, password)
- Ошибки валидации
- Состояние загрузки

**Методы:**
- `onSubmit` - обработчик отправки формы

**Пример использования:**
```tsx
<LoginForm />
```

### RegisterForm

Форма регистрации нового пользователя.

**Props:** Нет

**Состояние:**
- Данные формы (username, email, password)
- Ошибки валидации
- Состояние загрузки

**Методы:**
- `onSubmit` - обработчик отправки формы

**Пример использования:**
```tsx
<RegisterForm />
```

### UserNav

Навигация пользователя, которая отображается в верхней панели.

**Props:** Нет

**Состояние:** Использует контекст аутентификации

**Условия отображения:**
- Если пользователь авторизован, отображает аватар и меню с опцией выхода
- Если пользователь не авторизован, отображает кнопки входа и регистрации

**Пример использования:**
```tsx
<UserNav />
```

## Компоненты навигации

### RoomsNavBar

Боковая панель со списком комнат пользователя.

**Props:** Нет

**Состояние:**
- Использует контекст комнат для получения списка комнат
- Использует контекст аутентификации для проверки статуса пользователя

**Условия отображения:**
- Отображается только если пользователь авторизован и состоит хотя бы в одной комнате

**Методы:**
- `handleRoomSelect` - обработчик выбора комнаты

**Пример использования:**
```tsx
<RoomsNavBar />
```

### HomeNav

Отображает список комнат на домашней странице.

**Props:** Нет

**Состояние:**
- Использует контекст комнат для получения списка комнат
- Использует контекст аутентификации для проверки статуса пользователя

**Условия отображения:**
- Отображается только если пользователь авторизован

**Функциональность:**
- Отображает список комнат в виде карточек
- Предоставляет кнопки для создания новой комнаты и присоединения к существующей

**Пример использования:**
```tsx
<HomeNav />
```

## Компоненты чата

### ChatRoom

Основной компонент комнаты чата.

**Props:**
- `roomId: string` - идентификатор комнаты

**Состояние:**
- Информация о комнате
- Список сообщений
- Состояние загрузки
- Состояние подключения к WebSocket

**Методы:**
- `fetchMessages` - загрузка истории сообщений
- `handleSendMessage` - отправка нового сообщения
- `setupWebSocket` - настройка WebSocket подключения

**Пример использования:**
```tsx
<ChatRoom roomId="1234" />
```

### MessageList

Отображает список сообщений в комнате.

**Props:**
- `messages: Message[]` - массив сообщений
- `loading?: boolean` - состояние загрузки

**Состояние:** Нет локального состояния

**Функциональность:**
- Отображает сообщения в хронологическом порядке
- Автоматически прокручивает к последнему сообщению

**Пример использования:**
```tsx
<MessageList messages={messages} loading={loading} />
```

### MessageItem

Отображает отдельное сообщение.

**Props:**
- `message: Message` - объект сообщения

**Состояние:** Использует контекст аутентификации для определения, является ли сообщение собственным

**Функциональность:**
- Отображает аватар пользователя
- Отображает имя пользователя и время отправки
- Отображает текст сообщения
- Применяет разные стили для собственных и чужих сообщений

**Пример использования:**
```tsx
<MessageItem message={message} />
```

### MessageInput

Поле ввода нового сообщения.

**Props:**
- `onSendMessage: (text: string) => void` - функция отправки сообщения
- `disabled?: boolean` - флаг блокировки ввода

**Состояние:**
- Текст сообщения

**Методы:**
- `handleSubmit` - обработчик отправки сообщения
- `handleKeyPress` - обработчик нажатия клавиш (для отправки по Enter)

**Пример использования:**
```tsx
<MessageInput onSendMessage={handleSendMessage} disabled={!isConnected} />
```

## Компоненты комнат

### CreateRoomForm

Форма создания новой комнаты.

**Props:** Нет

**Состояние:**
- Данные формы (name)
- Ошибки валидации
- Состояние загрузки

**Методы:**
- `onSubmit` - обработчик отправки формы

**Пример использования:**
```tsx
<CreateRoomForm />
```

### JoinRoomForm

Форма присоединения к существующей комнате.

**Props:** Нет

**Состояние:**
- Данные формы (accessCode)
- Ошибки валидации
- Состояние загрузки

**Методы:**
- `onSubmit` - обработчик отправки формы

**Пример использования:**
```tsx
<JoinRoomForm />
```

## Взаимодействие компонентов

1. **Аутентификация и отображение UI:**
   - `AuthProvider` предоставляет информацию о пользователе
   - `UserNav` отображает соответствующий UI в зависимости от статуса аутентификации
   - `RoomsNavBar` отображается только для авторизованных пользователей с комнатами

2. **Управление комнатами:**
   - `RoomProvider` загружает и хранит список комнат пользователя
   - `HomeNav` отображает список комнат на домашней странице
   - `RoomsNavBar` отображает список комнат в боковой панели
   - При создании или присоединении к комнате вызывается `refreshRooms()`

3. **Чат:**
   - `ChatRoom` загружает информацию о комнате и историю сообщений
   - `MessageList` отображает сообщения
   - `MessageInput` позволяет отправлять новые сообщения
   - WebSocket обеспечивает обновление сообщений в реальном времени

## Советы для контрибьюторов

1. **Добавление нового компонента:**
   - Определите, к какой категории относится компонент (auth, chat, home, nav)
   - Создайте файл в соответствующей директории
   - Используйте TypeScript для типизации пропсов
   - Следуйте существующему стилю оформления компонентов

2. **Модификация существующего компонента:**
   - Проверьте, какие другие компоненты могут зависеть от модифицируемого
   - Сохраняйте обратную совместимость пропсов
   - Обновите документацию при изменении интерфейса компонента

3. **Стилизация компонентов:**
   - Используйте Tailwind CSS для стилизации
   - Следуйте принципам отзывчивого дизайна
   - Используйте компоненты Ant Design где это возможно 